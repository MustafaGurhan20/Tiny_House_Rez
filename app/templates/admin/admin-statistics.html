<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>İstatistikler - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="flex bg-gray-100">

  <!-- Sidebar -->
  <aside class="w-64 bg-blue-900 text-white min-h-screen p-4">
    <h1 class="text-2xl font-bold mb-6">Admin Paneli</h1>
    <nav class="space-y-2">
      <a href="/admin/dashboard" class="block hover:bg-blue-700 p-2 rounded">Dashboard</a>
      <a href="/admin/user-management" class="block hover:bg-blue-700 p-2 rounded">Kullanıcı Yönetimi</a>
      <a href="/admin/reservations" class="block hover:bg-blue-700 p-2 rounded">Rezervasyon Yönetimi</a>
      <a href="/admin/listings" class="block hover:bg-blue-700 p-2 rounded">İlan Yönetimi</a>
      <a href="/admin/payments" class="block hover:bg-blue-700 p-2 rounded">Ödeme Yönetimi</a>
      <a href="/admin/statistics" class="block bg-blue-700 p-2 rounded">İstatistikler</a>
      <a href="/" class="block bg-red-600 hover:bg-red-700 text-white p-2 rounded text-center mt-6">Çıkış Yap</a>
    </nav>
  </aside>

  <!-- Content -->
  <main class="flex-1 p-6 space-y-6">

    <h2 class="text-2xl font-bold mb-4">İstatistikler ve Raporlama</h2>

    <!-- Özet Kartlar -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold">Toplam Kullanıcı</h3>
        <p class="text-3xl text-blue-700">{{ total_users }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold">Aktif Kullanıcı</h3>
        <p class="text-3xl text-green-700">{{ active_users }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold">Yeni Üye (Son 30 gün)</h3>
        <p class="text-3xl text-purple-700">{{ new_users }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold">Toplam Yorum</h3>
        <p class="text-3xl text-yellow-600">{{ comments_count }}</p>
      </div>
    </section>

    <!-- Rezervasyon Trend Grafiği -->
    <section class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4">Rezervasyon Trend (Aylık)</h3>
      <canvas id="reservationsChart"></canvas>
    </section>

    <!-- Ödeme Trend Grafiği -->
    <section class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4">Ödeme Trend (Aylık)</h3>
      <canvas id="paymentsChart"></canvas>
    </section>

    <!-- Chart.js Script -->
    <script>
      const reservationsCtx = document.getElementById('reservationsChart').getContext('2d');
      const reservationsChart = new Chart(reservationsCtx, {
        type: 'line',
        data: {
          labels: {{ reservations_trend | map(attribute='month') | list | safe }},
          datasets: [{
            label: 'Rezervasyon Sayısı',
            data: {{ reservations_trend | map(attribute='count') | list | safe }},
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            fill: true,
            tension: 0.3
          }]
        }
      });

      const paymentsCtx = document.getElementById('paymentsChart').getContext('2d');
      const paymentsChart = new Chart(paymentsCtx, {
        type: 'bar',
        data: {
          labels: {{ payments_trend | map(attribute='month') | list | safe }},
          datasets: [{
            label: 'Toplam Gelir (₺)',
            data: {{ payments_trend | map(attribute='total') | list | safe }},
            backgroundColor: 'rgb(34, 197, 94)'
          }]
        }
      });
    </script>

  </main>
</body>
</html>
